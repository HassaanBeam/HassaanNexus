#!/usr/bin/env python3
"""
{{SERVICE_NAME}} {{OPERATION_NAME}}

{{OPERATION_DESCRIPTION}}.

Usage:
    python {{OPERATION_SLUG}}.py {{CLI_ARGS}}
    python {{OPERATION_SLUG}}.py --help
"""

import argparse
import json
import sys
from pathlib import Path

# Add parent directory to path for imports
SCRIPT_DIR = Path(__file__).parent
sys.path.insert(0, str(SCRIPT_DIR.parent.parent / "{{SERVICE_SLUG}}-master" / "scripts"))

from {{SERVICE_SLUG}}_client import get_client


def {{FUNCTION_NAME}}({{FUNCTION_PARAMS}}) -> dict:
    """
    {{FUNCTION_DOCSTRING}}

    Args:
{{ARGS_DOCSTRING}}

    Returns:
        dict: API response
{{RETURNS_DOCSTRING}}
    """
    client = get_client()

{{FUNCTION_BODY}}


def main():
    parser = argparse.ArgumentParser(
        description="{{OPERATION_DESCRIPTION}}",
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
Examples:
{{CLI_EXAMPLES}}

Environment Variables (in .env at project root):
{{ENV_VARS_HELP}}
        """
    )

{{ARGPARSE_ARGS}}

    parser.add_argument(
        "--output", "-o",
        help="Output file path (default: stdout)"
    )

    args = parser.parse_args()

    try:
        result = {{FUNCTION_NAME}}({{FUNCTION_CALL_ARGS}})
        output = json.dumps(result, indent=2)

        if args.output:
            Path(args.output).write_text(output)
            print(f"Output written to: {args.output}")
        else:
            print(output)

    except ValueError as e:
        print(f"Configuration error: {e}", file=sys.stderr)
        sys.exit(1)
    except Exception as e:
        if hasattr(e, 'response'):
            print(f"API error: {e.response.status_code} - {e.response.text}", file=sys.stderr)
        else:
            print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)


if __name__ == "__main__":
    main()
